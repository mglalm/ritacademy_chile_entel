<?xml version="1.0" encoding="UTF-8" ?>
<script name="EMA.scriptEMA">
  <label>ScriptEMA</label>
  <metaVersion>25</metaVersion>
  <parameterList>
    <parameter name="input" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    var fnd = new Finder('EMA.findIMSI');
    var doc = fnd.search();

    var i = 0;
    var output = new DataStructure("EMA.responseEMA");
    var grabarDocumento = new Document("EMA.clienteHLR");


    var grabar = 0;

    for (i=0;i<doc.length & grabar == 0;i=i+1)
    {
    if (doc[i].MSISDN == input.MSISDN) {grabar = 1; output.mensaje= "Ok"; output.estado = "Perfil de MSISDN " + input.MSISDN + " actualizado";
          doc[i].MSISDN = input.IMSI;
          doc[i].PROFILE = input.PROFILE;
          doc[i].save();
    }



    if (input.IMSI == null) {grabar = 1; output.mensaje= "No/Ok"; output.estado = "IMSI nula"}}

    if (grabar == 0)
      {
          grabarDocumento.MSISDN = input.MSISDN;
          grabarDocumento.IMSI = input.IMSI;
          grabarDocumento.PROFILE = input.PROFILE;
          grabarDocumento.save(); output.mensaje= "Ok"; output.estado = "Plan Asignado a la MSISDN " + input.MSISDN;}

    return output;



    /*
    var output = new DataStructure("EMA.responseEMA");
    var grabarDocumento = new Document("EMA.clienteHLR");


    grabarDocumento.IMSI = input.IMSI;
    grabarDocumento.MSISDN = input.MSISDN;
    grabarDocumento.PROFILE = input.PROFILE;

    grabarDocumento.save(); output.mensaje= "Ok"; output.estado = "Provisionada la MSISDN " + input.MSISDN;



    return output;

    */
  ]]></script>
</script>