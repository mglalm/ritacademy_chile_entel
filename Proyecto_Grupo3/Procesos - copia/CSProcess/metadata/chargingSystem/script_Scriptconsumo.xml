<?xml version="1.0" encoding="UTF-8" ?>
<script name="chargingSystem.Scriptconsumo">
  <label>Consumo</label>
  <metaVersion>25</metaVersion>
  <parameterList>
    <parameter name="input" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    var fnd = new Finder('chargingSystem.findMSISDNConsumo');
    var docprocess = new Document('chargingSystem.procDoc');
    var doc = fnd.search();
    var i = 0;
    var output = new DataStructure("chargingSystem.ackConsumoCS");
    //var grabarDocumento = new Document("chargingSystem.gg_ConsumoClienteCS");
    var saldoDespuesConsumo = 0;
    var consumo = 0;

    for(i=0;i<doc.length;i=i+1)
    {
        if(doc[i].MSISDN==input.MSISDN)
        {
            consumo = (input.usage*doc[i].tarifa);
            doc[i].saldo = doc[i].saldo -consumo;
            doc[i].save();
            saldoDespuesConsumo= doc[i].saldo;
        }
    }

    docprocess.MSISDN = input.MSISDN;
    docprocess.saldo = saldoDespuesConsumo;
    docprocess.usage = input.usage;
    docprocess.consumo = consumo;

    var ProcessID = Process.startProcess('chargingSystem.clienteCS',docprocess,null,null);

    output.ackConsumo = saldoDespuesConsumo;

    return output;
  ]]></script>
</script>